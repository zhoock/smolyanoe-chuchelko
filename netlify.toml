[build]
  publish = "dist"   # <— ВАЖНО: откуда Netlify берёт файлы для прод-раздачи

[dev]
  command = "npm start" # команда для запуска вашего dev-сервера (например, React Dev Server)
  targetPort = 8080 # порт, на котором работает ваш webpack dev server
  port = 8888 # порт, на котором Netlify будет проксировать запросы

# API routes должны быть ПЕРЕД общим redirect на index.html
# API routes для сохранения синхронизаций
[[redirects]]
  from = "/api/synced-lyrics*"
  to = "/.netlify/functions/synced-lyrics"
  status = 200
  force = true

# Старый endpoint для обратной совместимости
[[redirects]]
  from = "/api/save-synced-lyrics*"
  to = "/.netlify/functions/synced-lyrics"
  status = 200
  force = true

# API route для загрузки файлов в Supabase Storage
[[redirects]]
  from = "/api/upload-file*"
  to = "/.netlify/functions/upload-file"
  status = 200
  force = true

# API route для сохранения текста трека
[[redirects]]
  from = "/api/save-track-text*"
  to = "/.netlify/functions/save-track-text"
  status = 200
  force = true

# API route для применения миграций БД (только для админов)
[[redirects]]
  from = "/api/apply-migrations*"
  to = "/.netlify/functions/apply-migrations"
  status = 200
  force = true

# API route для миграции JSON в БД (только для админов)
[[redirects]]
  from = "/api/migrate-json-to-db*"
  to = "/.netlify/functions/migrate-json-to-db"
  status = 200
  force = true

# API route для работы с альбомами
[[redirects]]
  from = "/api/albums*"
  to = "/.netlify/functions/albums"
  status = 200
  force = true

# API route для работы с профилем пользователя (theBand)
[[redirects]]
  from = "/api/user-profile*"
  to = "/.netlify/functions/user-profile"
  status = 200
  force = true

# API route для работы со статьями пользователей
[[redirects]]
  from = "/api/articles-api*"
  to = "/.netlify/functions/articles-api"
  status = 200
  force = true

# API route для аутентификации
[[redirects]]
  from = "/api/auth/*"
  to = "/.netlify/functions/auth"
  status = 200
  force = true

# API route для загрузки файлов в Supabase Storage
[[redirects]]
  from = "/api/upload-file*"
  to = "/.netlify/functions/upload-file"
  status = 200
  force = true

# API routes для платежей ЮKassa
[[redirects]]
  from = "/api/create-payment*"
  to = "/.netlify/functions/create-payment"
  status = 200
  force = true

[[redirects]]
  from = "/api/payment-webhook*"
  to = "/.netlify/functions/payment-webhook"
  status = 200
  force = true

[[redirects]]
  from = "/api/payment-settings*"
  to = "/.netlify/functions/payment-settings"
  status = 200
  force = true

# Исключаем статические файлы из redirect на index.html
# Эти redirects должны быть ПЕРЕД общим redirect для SPA
# В dev режиме Netlify Dev автоматически проксирует их на webpack dev server (порт 8080)
# force = false позволяет Netlify Dev проксировать запросы на targetPort в dev режиме
[[redirects]]
  from = "/scripts/*"
  to = "/scripts/:splat"
  status = 200

[[redirects]]
  from = "/styles/*"
  to = "/styles/:splat"
  status = 200

[[redirects]]
  from = "/images/*"
  to = "/images/:splat"
  status = 200

[[redirects]]
  from = "/audio/*"
  to = "/audio/:splat"
  status = 200

[[redirects]]
  from = "/assets/*"
  to = "/assets/:splat"
  status = 200

# Общий redirect для SPA - должен быть ПОСЛЕДНИМ
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200


