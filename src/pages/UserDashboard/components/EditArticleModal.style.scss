// src/pages/UserDashboard/components/EditArticleModal.style.scss
@use '../../../scss/abstracts/mixins' as *;

.edit-article-modal {
  display: flex;
  align-items: stretch;
  justify-content: center;
  min-height: 100vh;
  margin: 0;
  padding: 0;
  background: transparent;

  &__card {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 1000px;
    max-height: 100vh;
    margin: 0 auto;
    padding: 0;
    background: var(--deep-black);
    border: none;
    border-radius: 0;
    box-shadow: none;
    overflow-y: auto;
  }

  &__header {
    position: sticky;
    top: 0;
    z-index: 10;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--ms-1);
    border-bottom: 1px solid var(--iron-slate);
    background: var(--deep-black);
  }

  &__header-left {
    display: flex;
    align-items: center;
    gap: var(--ms-1);
    flex: 1;
  }

  &__auto-save-indicator {
    font-size: var(--ms-0);
    opacity: 0.7;
  }

  &__auto-save-status {
    &.saving {
      color: var(--graphite-green);
      animation: pulse 1.5s ease-in-out infinite;
    }

    &.saved {
      color: var(--graphite-green);
    }

    &.draft {
      color: var(--iron-slate);
    }
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 0.7;
    }

    50% {
      opacity: 1;
    }
  }

  &__title {
    margin: 0;
    padding: 0;
    color: var(--white);
    font-size: var(--ms-1);
    font-weight: 700;
    line-height: 1.2;
  }

  &__close {
    display: flex;
    width: 32px;
    height: 32px;
    padding: 0;
    color: var(--white);
    font-size: 32px;
    line-height: 1;
    background: none;
    border: none;
    cursor: pointer;
    transition: opacity 0.2s;
    align-items: center;
    justify-content: center;

    &:hover {
      opacity: 0.7;
    }
  }

  // Кнопка слева от параграфа
  &__paragraph-button {
    width: 24px;
    height: 24px;
    padding: 0;
    color: var(--warm-concrete);
    font-size: 18px;
    line-height: 1;
    background: rgba(var(--white-rgb) / 10%);
    border: none;
    border-radius: 50%;
    transition:
      color 0.2s,
      background 0.2s;
    align-items: center;
    justify-content: center;
    margin-right: var(--ms-01);
    cursor: pointer;
    vertical-align: middle;
    flex-shrink: 0;
    pointer-events: auto; // Кнопка должна быть кликабельной

    &:focus-visible {
      outline: none;
    }
  }

  // Страница статьи в стиле фронтенда
  &__content-editable {
    outline: none;

    &:focus-visible {
      outline: none;
    }

    // Стили для параграфов с кнопками
    p[data-block-type='text'] {
      position: relative;
      display: flex;
      align-items: flex-start;
      min-height: 24px;

      // Показываем кнопку при фокусе или наведении на параграф
      &:hover,
      &:focus-within {
        .edit-article-modal__paragraph-button {
          display: inline-flex;
        }
      }
    }
  }

  &__article {
    position: relative;
    padding: var(--ms-2) 0;
    min-height: auto;

    .wrapper {
      position: relative;
      max-width: 720px;
      padding-inline: var(--ms-1);
    }
  }

  // Редактируемые элементы
  &__editable-title,
  &__editable-h3,
  &__editable-h4,
  &__editable-p,
  &__editable-strong,
  &__editable-li {
    &:hover {
      border-radius: 2px;
    }
  }

  // Обёртки для изображений и каруселей
  &__image-wrapper,
  &__carousel-wrapper {
    position: relative;
    cursor: pointer;
    outline: 2px solid transparent;
    outline-offset: 4px;
    border-radius: var(--ms-01);
    transition:
      outline 0.2s,
      box-shadow 0.2s;

    &--selected {
      outline: 2px solid var(--graphite-green);
      box-shadow: 0 0 0 4px rgba(var(--graphite-green-rgb) / 20%);
    }

    &:focus-visible {
      outline: none;
    }
  }

  &__create-carousel-button {
    position: absolute;
    top: var(--ms-01);
    right: var(--ms-01);
    z-index: 6;
    opacity: 0;
    font-size: var(--ms-0);
    transition: opacity 0.2s;

    @include button-variant(
      $color: var(--white),
      $background: rgba(var(--black-rgb) / 80%),
      $hover-color: var(--white),
      $hover-background: rgba(var(--black-rgb) / 90%),
      $margin: 0,
      $padding: var(--ms-01) var(--ms-0),
      $border: 0,
      $border-radius: var(--ms-01)
    );
  }

  &__carousel-edit-button {
    position: absolute;
    top: var(--ms-01);
    right: var(--ms-01);
    z-index: 5;
    opacity: 0;
    font-size: var(--ms-0);
    transition: opacity 0.2s;

    @include button-variant(
      $color: var(--white),
      $background: rgba(var(--black-rgb) / 80%),
      $hover-color: var(--white),
      $hover-background: rgba(var(--black-rgb) / 90%),
      $margin: 0,
      $padding: var(--ms-01) var(--ms-0),
      $border: 0,
      $border-radius: var(--ms-01)
    );

    &:hover {
      opacity: 1;
    }
  }

  &__image-wrapper:hover &__create-carousel-button {
    opacity: 1;
  }

  &__carousel-wrapper:hover &__carousel-edit-button {
    opacity: 1;
  }

  &__carousel-edit {
    padding: var(--ms-1);
    background: rgba(var(--white-rgb) / 5%);
    border-radius: var(--ms-01);
  }

  &__carousel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: var(--ms-01);
    margin-bottom: var(--ms-01);
  }

  &__carousel-item {
    position: relative;
    aspect-ratio: 1;
    border-radius: var(--ms-01);
    overflow: hidden;
  }

  &__carousel-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  &__carousel-remove {
    position: absolute;
    top: 4px;
    right: 4px;
    z-index: 5;
    display: flex;
    width: 24px;
    height: 24px;
    align-items: center;
    justify-content: center;
    color: var(--white);
    font-size: 18px;
    line-height: 1;
    background: rgba(var(--red-rgb) / 80%);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.2s;

    &:hover {
      background: rgba(var(--red-rgb) / 100%);
    }
  }

  &__carousel-add {
    display: flex;
    align-items: center;
    justify-content: center;
    aspect-ratio: 1;
    background: rgba(var(--white-rgb) / 2%);
    border: 2px dashed var(--iron-slate);
    border-radius: var(--ms-01);
    transition:
      border-color 0.2s,
      background 0.2s;

    &:hover {
      border-color: var(--graphite-green);
      background: rgba(var(--white-rgb) / 5%);
    }
  }

  &__carousel-actions {
    display: flex;
    justify-content: flex-end;
    margin-top: var(--ms-01);
  }

  &__add-blocks {
    position: relative;
    margin-top: var(--ms-2);
    padding-top: var(--ms-2);
    border-top: 1px solid var(--iron-slate);
  }

  &__text-input-wrapper {
    display: flex;
    align-items: flex-start;
    gap: var(--ms-01);
  }

  &__text-input {
    flex: 1;
    padding: var(--ms-01) var(--ms-0);
    color: var(--white);
    font-size: var(--ms-0);
    font-family: inherit;
    background: transparent;
    border: none;
    border-bottom: 1px solid var(--iron-slate);
    border-radius: 0;
    outline: none;
    resize: none;
    transition: border-color 0.2s;

    &:focus {
      border-bottom-color: var(--graphite-green);
    }

    &::placeholder {
      color: var(--warm-concrete);
      opacity: 0.7;
    }
  }

  &__add-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    padding: 0;
    color: var(--white);
    font-size: 24px;
    line-height: 1;
    background: var(--iron-slate);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    transition:
      background 0.2s,
      transform 0.2s;
    flex-shrink: 0;

    &:hover {
      background: var(--graphite-green);
      transform: scale(1.1);
    }

    &:active {
      transform: scale(0.95);
    }
  }

  &__toolbar {
    display: flex;
    align-items: center;
    gap: var(--ms-01);
    margin-top: var(--ms-01);
    padding: var(--ms-01);
    background: rgba(var(--white-rgb) / 5%);
    border-radius: var(--ms-01);
  }

  &__toolbar-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    padding: 0;
    color: var(--white);
    background: transparent;
    border: none;
    border-radius: var(--ms-01);
    cursor: pointer;
    transition:
      background 0.2s,
      transform 0.2s;

    &:hover {
      background: rgba(var(--white-rgb) / 10%);
      transform: scale(1.1);
    }
  }

  // Тултип для кнопки "+" слева от параграфа
  &__paragraph-toolbar {
    position: absolute;
    z-index: 100;
    display: flex;
    align-items: center;
    gap: var(--ms-01);
    padding: var(--ms-01);
    background: rgba(var(--white-rgb) / 10%);
    border: 1px solid var(--iron-slate);
    border-radius: var(--ms-01);
    box-shadow: 0 4px 12px rgba(var(--black-rgb) / 30%);
  }

  &__paragraph-toolbar-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    padding: 0;
    color: var(--white);
    background: transparent;
    border: none;
    border-radius: var(--ms-01);
    cursor: pointer;
    transition:
      background 0.2s,
      transform 0.2s;

    &:hover {
      background: rgba(var(--white-rgb) / 15%);
      transform: scale(1.1);
    }

    svg {
      width: 20px;
      height: 20px;
    }

    &:active {
      transform: scale(0.95);
    }
  }

  &__divider {
    margin: var(--ms-2) 0;
    border: none;
    border-top: 1px solid var(--iron-slate);
  }

  &__control-button {
    @include button-variant(
      $color: var(--white),
      $background: var(--iron-slate),
      $hover-color: var(--white),
      $hover-background: rgba(var(--white-rgb) / 10%),
      $margin: 0,
      $padding: var(--ms-01) var(--ms-0),
      $border: 0,
      $border-radius: var(--ms-01)
    );
  }

  &__button {
    padding: var(--ms-01) var(--ms-0);
    font-size: var(--ms-0);
    border: none;
    border-radius: var(--ms-01);
    font-weight: 500;
    cursor: pointer;
    transition:
      opacity 0.2s,
      background 0.2s;

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    &--primary {
      color: var(--white);
      background: var(--graphite-green);

      &:hover:not(:disabled) {
        opacity: 0.9;
      }
    }

    &--secondary {
      color: var(--white);
      background: var(--iron-slate);

      &:hover:not(:disabled) {
        background: rgba(var(--white-rgb) / 10%);
      }
    }
  }

  &__footer {
    position: sticky;
    bottom: 0;
    z-index: 10;
    display: flex;
    justify-content: flex-end;
    gap: var(--ms-01);
    padding: var(--ms-1);
    border-top: 1px solid var(--iron-slate);
    background: var(--deep-black);
  }

  &__formatting-tooltip {
    position: fixed;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 0;
    padding: var(--ms-01);
    background: var(--iron-slate);
    border-radius: var(--ms-01);
    box-shadow: 0 4px 12px rgb(0 0 0 / 30%);
    pointer-events: auto;
    opacity: 0;
    transition:
      opacity 0.2s ease-out,
      transform 0.2s ease-out;
    transform: translate(-50%, 10px);

    &--visible {
      opacity: 1;
      transform: translate(-50%, 20%);
    }
  }

  &__formatting-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    font-size: var(--ms-0);
    font-weight: 400;
    border-radius: var(--ms-01);
    cursor: pointer;

    @include button-variant(
      $color: var(--white),
      $background: transparent,
      $hover-color: var(--white),
      $hover-background: var(--graphite-green),
      $border: none,
      $padding: var(--ms-01),
      $margin: 0олж
    );

    &--active {
      color: var(--white);
      background: var(--graphite-green);
    }

    svg {
      width: 16px;
      height: 16px;
    }

    strong {
      font-weight: 700;
    }
  }

  &__formatting-separator {
    width: 1px;
    height: 20px;
    margin: var(--ms-01);
    background: rgb(255 255 255 / 20%);
  }

  &__inline-image,
  &__inline-carousel {
    position: relative;
    display: inline-block;
    margin: var(--ms-1) 0;
    cursor: pointer;
    border: 2px solid transparent;
    border-radius: var(--ms-01);
    transition:
      border-color 0.2s,
      box-shadow 0.2s;

    &--selected {
      border: 2px solid var(--white-rgb) !important;
      box-shadow: 0 0 0 4px rgba(var(--graphite-green-rgb) / 20%) !important;
    }

    img {
      display: block;
      max-width: 100%;
      height: auto;
    }
  }

  &__inline-carousel {
    position: relative;

    &__carousel-indicator {
      position: absolute;
      right: var(--ms-01);
      bottom: var(--ms-01);
      padding: var(--ms-01) var(--ms-0);
      color: var(--white);
      font-size: var(--ms-0);
      background: rgba(var(--black-rgb) / 70%);
      border-radius: var(--ms-01);
    }
  }
}
